package com.adonis.ui.img;

import java.util.ArrayList;
import java.util.List;

import com.vaadin.navigator.View;
import com.vaadin.navigator.ViewChangeListener;
import com.vaadin.ui.AbsoluteLayout;
import org.htmlparser.Parser;
import org.htmlparser.Tag;
import org.htmlparser.filters.TagNameFilter;
import org.htmlparser.util.NodeList;
import org.htmlparser.util.ParserException;
import org.htmlparser.util.SimpleNodeIterator;
import com.vaadin.server.ExternalResource;
import org.tepi.imageviewer.ImageViewer;

import com.vaadin.annotations.AutoGenerated;

import com.vaadin.ui.Button;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.TextField;

public class ImgSlider extends CustomComponent implements View,Button.ClickListener{

    @AutoGenerated
    private AbsoluteLayout mainLayout;
    @AutoGenerated
    private Button button_1;
    @AutoGenerated
    private TextField textField_1;
    @AutoGenerated
    private ImageViewer imageViewer_1;

    private ExternalResource img;
    private List<ExternalResource> images = new ArrayList<ExternalResource>();

    private Parser parser;
    private NodeList list;
    private String imgurl;



    public ImgSlider() {
        buildMainLayout();
        setCompositionRoot(mainLayout);

        button_1.addClickListener(this);
        fillimages();


    }




    public void buttonClick (Button.ClickEvent event) {

        fillimages();
    }

    public void fillimages(){
        images = new ArrayList<ExternalResource>();

        imgurl = textField_1.getValue();

        if (imgurl.isEmpty()){
            imgurl="http://bild.de";
            textField_1.setValue(imgurl);
        }


        try {
            if (imgurl!=null && !imgurl.isEmpty()) {
                parser = new Parser(imgurl);//TODO proxy
            }

        } catch (ParserException e) {

            e.printStackTrace();
            return;
        }

        try {
            list = parser.parse(new TagNameFilter("IMG"));
        } catch (ParserException e) {

            e.printStackTrace();
            return;
        }

        for ( SimpleNodeIterator iterator = list.elements(); iterator.hasMoreNodes(); ) {

            Tag tag = (Tag) iterator.nextNode();
            img = new ExternalResource(tag.getAttribute("src"));

            images.add(img);

        }
        imageViewer_1.setImages(images);
        imageViewer_1.setCaption(imgurl);
        imageViewer_1.requestRepaint();
        imageViewer_1.focus();
    }

    @AutoGenerated
    private AbsoluteLayout buildMainLayout() {
        // common part: create layout
        mainLayout = new AbsoluteLayout();
//        mainLayout.setImmediate(false);
        mainLayout.setWidth("100%");
        mainLayout.setHeight("100%");
//        mainLayout.setMargin(false);

        // top-level component properties
        setWidth("100.0%");
        setHeight("100.0%");

        // imageViewer_1
        imageViewer_1 = new ImageViewer();
//        imageViewer_1.setImmediate(false);
        imageViewer_1.setWidth("100.0%");
        imageViewer_1.setHeight("420px");
        mainLayout.addComponent(imageViewer_1,
                "top:240.0px;right:18.0px;left:60.0px;");

        // textField_1
        textField_1 = new TextField();
//        textField_1.setImmediate(false);
        textField_1.setWidth("260px");
        textField_1.setHeight("-1px");
//        textField_1.setSecret(false);
        mainLayout.addComponent(textField_1, "top:76.0px;left:60.0px;");

        // button_1
        button_1 = new Button();
        button_1.setCaption("load images from url");
//        button_1.setImmediate(false);
        button_1.setWidth("-1px");
        button_1.setHeight("-1px");
        mainLayout.addComponent(button_1, "top:140.0px;left:60.0px;");

        return mainLayout;
    }

    @Override
    public void enter(ViewChangeListener.ViewChangeEvent event) {

    }
}